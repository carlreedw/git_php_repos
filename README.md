<p align="center">
  <h3 align="center">GitHub PHP Repositories</h3>

  <p align="center">
    This tool queries the GitHub API (v3) to search for the most starred PHP projects and displays them in a list.
  </p>
</p>

<br>

# Table of contents

- [Overview](#overview)
- [Architecture description](#architecture-description)
- [Routing diagram](#routing-diagram)
- [How to install](#how-to-install)
- [How to use](#how-to-use)

# Overview

The tool consists of some client code (html, css, and javascript) that makes calls to files hosted on a web server (php and html).

The server queries the GitHub API's repository endpoint: 'https://api.github.com/search/repositories' for individual repo information.

The server stores the information in a MySQL database. Then it can retrieve that information to create HTML to send to the client.

# Architecture description

The file structure:

```
git_php_repos/
  ├── css/
  │    └── style.css
  ├── includes/
  │    ├── debug.log
  │    ├── make_repos_table.sql
  │    ├── refresh_client.php
  │    ├── refresh_database.php
  │    ├── sample_output.txt
  │    └── send_card.php
  ├── js/
  │    ├── jquery.js
  │    └── requestor.js
  ├── materialize/
  │    ├── css/
  │    |	└── materialize.min.css
  │    ├── js/
  │    |	└── materialize.min.js
  │    ├── LICENSE
  │    └── README.md
  ├── index.php
  └── README.md
```

The `materialize` and `css` folders help with presentation of the tool. They allow collapsing and expanding of the repository items in the list and styling of text and buttons.

`requestor.js` contains the Javascript necessary to make calls to the server and update the client's browser with received information.

`includes/refresh_database.php` does three things in sequence:

1. Create `repositories` table and schema in `git_php_repos` database of localhost's MySQL server if it doesn't exist.
2. Query the GitHub API (v3 - RESTful) to retreive a list of the most starred PHP projects in serialized JSON format. Public repositories with the topic tag PHP and more than 10,000 stars are considered "most starred PHP projects".
3. Creates and executes a SQL query to insert values into our `repositories` table.
	
`includes/refresh_client.php` does two things in sequence:

1. Creates and queries the `repositories` table for repository information.
2. Iterates through each repository item received and outputs html to return to the client.

`includes/sample_output.txt` was used during development to avoid excessive API calls, and is retained in this repository in the case that users would like to run the tool without access to GitHub's servers.

`includes/debug.log` is overwritten everytime `refresh_database.php` is executed. It contains helpful development information about success/failure of connecting to the MySQL database and cURL execution of the API query.

`includes/make_repos_table.sql` is used in `refresh_database.php` to build the `repositories` table.

`includes/send_card.php` is included in `refresh_database.php` and `refresh_client.php`. It creates a `Materialize` card with a message on what the server encountered.

Finally, `index.php` is page served to the client initially that allows them to make calls via `requestor.js` to refresh the database or the client.

# Routing diagram

![Routing Diagram](https://i.imgur.com/KNn9KjJ.png)

Alphabetic routes cross server/client boundary whereas numeric routes are server-side (here we consider GitHub API calls to be server-server).

ROUTE A:

* Client sends default request to `[[SERVER_ADDRESS]]/git_php_repos/index.php`
	
	OR
	
* Client clicks `REFRESH DATABASE` to send HTTP request to `git_php_repos/includes/refresh_database.php` via requestor.js function `refresh_database()`
	
	OR
	
* Client clicks `REFRESH CLIENT` to send HTTP request to `git_php_repos/includes/refresh_client.php` via requestor.js function `refresh_client()`

ROUTE B (respectively):

* Server returns html generated by `index.php` to client

	OR

* Server either sends an explanation of why the database can't be refreshed or "Database refreshed!" message to the client. Javascript on the client loads message into the `#mainContent` element.

	OR

* Server sends a "No repositories in database." message, or HTTP response that presents the repository information retrieved from the MySQL database. Javascript on the client loads response presentation into the `#mainContent` element.

ROUTE 1:

* cURL session is created and executed to retrieve JSON encoded string from `https://api.github.com/search/repositories` endpoint

ROUTE 2:

* GitHub responds to ROUTE 1 request with error or encoded repository data

ROUTE 3:

* Our web server sends a query string to our `localhost` MySQL database to request repository data

ROUTE 4:

* MySQL returns an error or our database results that we retrieve via the `mysqli_fetch_array` PHP function

# How to install

Install and configure your web server

1. Install your web server of choice. For example, you may use [XAMPP](https://www.apachefriends.org/index.html).

2. If you've installed XAMPP, you can open the `XAMPP Control Panel` and click the red X under "Service" in the "Modules" section to create an instance of Apache. Apache is the name of the web server bundled with XAMPP.

> ![XAMPP Control Panel](https://i.imgur.com/lOnOrSJ.png)

3. Once you've instanciated Apache on your system you can click "Start" and then "Stop" under "Actions" in the Control Panel to start and stop the server respectively.

4. **NOTE:** You may need to configure a port other than 80 to start/instanciate Apache. To do this, click `Config > Apache (httpd.conf)`. In the `httpd.conf` file, search for `Listen 80` and `ServerName localhost:80`. Replace `80` with a port of your choice in both places.

5. Place the unzipped `git_php_repos` folder into the public access folder of your web server. E.g., "htdocs", "Sites" -- the exact folder location depends on your particular web server.

6. You should now be able to visit `localhost/git_php_repos` or `localhost:1234/git_php_repos` where `1234` is instead your configured web server port to see the tool's interface.

> ![What the interface should look like](https://i.imgur.com/UU2qraE.png?1)
	
Create and configure your MySQL server instance

1. This tool is designed to use a MySQL server available through the localhost address/hostname. If you've installed XAMPP, you can create the server instance by clicking the red X button under "Service" in the Modules section of the XMAPP Control Panel

2. After you've instanciated your server and started the service associated with it, create a database on the server by going to `localhost/phpmyadmin` control panel in your favorite browser.

3. At the PHPMyAdmin tool, click "New" near the top of the sidebar. In the "Database name" input field that appears, enter `git_php_repos` and click the "Create" button.

4. The sidebar will automatically refresh and you should see `git_php_repos` listed under "New" in the sidebar. This signifies that your database is created. You do not need to create any tables in the database.

If you are behind a proxy, you will need to edit `refresh_database.php`

* See lines 3-4.

1. In `define("PROXY_IP", '255.255.255.255');` -- change `255.255.255.255` to the IP address of your proxy server.

2. In `define("PROXY_PORT", 1234);` -- change `1234` to the port your proxy server expects your traffic on.

You've installed GitHub PHP Repositories!

# How to use

1. Go to your favorite browser and visit "localhost/git_php_repos" adding a port specification if necessary.

2. Click the "REFRESH DATABASE" button to pull GitHub API repository information into your MySQL server instance.

3. Click the "REFRESH CLIENT" button to update the browser with repository information from the MySQL database.

> ![Example of execution](https://i.imgur.com/YKu8MGO.png)

# Credits

Materialize CSS (https://materializecss.com/about.html) (https://github.com/dogfalo/materialize/) @MaterializeCSS

* Alvin Wang

* Alan Chang

* Alex Mark

* Kevin Louie

The jQuery Team at the jQuery Foundation (https://jquery.org/team/)

The W3C Consortium, ECMA International, Zend Technologies.
